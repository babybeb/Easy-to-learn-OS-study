# 파일과 파일 시스템

컴퓨터 시스템에는 다양한 파일이 있으며 이러한 파일은 하드디스크나 CD같은 제2 저장장치에 보관된다.

사용자가 직접 파일을 보관하거나 관리하면 문제가 생기므로 운영체제는 대신 파일을 보관하고 관리하는 *파일 관리자*를 두어

저장장치의 전체 관리를 맡기는데 이를 `파일 시스템` 이라 한다.

파일 관리자는 파일 테이블을 사용하여 파일의 생성,수정,삭제 등을 수행한다.

사용자가 특정 파일에 접근하려면 파일 관리자로부터 파일에 접근할 수 있는 권한(키)을 획득해야 하는데 파일 접근 권한을 `파일 디스크럽터(file descriptor)` 라 한다.

<br />

## 파일 시스템의 기능

| 기능           | 설명                                                                                                       |
| -------------- | ---------------------------------------------------------------------------------------------------------- |
| 파일 구성      | 사용자의 요구에 따라 파일과 디렉터리를 만든다.                                                             |
| 파일 관리      | 파일 생성, 수정, 삭제 등의 관리를 하고 수시로 조각 모음을 하여 사용자가 파일에 빨리 접근할 수 있도록 한다. |
| 접근 권한 관리 | 다른 사용자로부터 파일을 보호하기 위해 접근 권한을 관리한다.                                               |
| 접근 방법 제공 | 파일을 읽고 쓰고 실행할 수 있도록 사용자에게 접근 방법을 제공한다.                                         |
| 무결성 보장    | 파일의 내용이 손상되지 않도록 무결성을 보장한다.                                                           |
| 백업과 복구    | 사고로부터 파일을 보호하기 위헤 백업과 복구 작업을 한다.                                                   |
| 암호화         | 파일을 암호화하여 악의적인 접근으로부터 파일을 보호한다.                                                   |

<br />

## 블록과 파일 테이블

데이터는 운영체제와 저장장치 간에 블록 단위로 전송한다.

하드디스크의 가장 작은 저장 단위는 섹터인데, 메모리와 저장장치의 크기카 수백 배 차이 나므로 섹터 단위로 주소를 부여하면 너무 많은 주소가 필요해서 비효율적이다.

그래서 파일 관리자는 여러 섹터를 묶어 블록 단위로 만들어서 주소를 배정한다.

블록의 크기는 운영체제마다 다른데 블록 크기를 작게 설정하면 내부 단편화 현상이 줄어들어 효율적이지만 파일이 여러 블록으로 나뉘어 I/O 속도가 느려진다. 따라서 큰 파일을 많이 사용할 때는 블록 크기를 크게 잡는것이 좋다.

<br />

## 파일 분류와 확장자

파일은 논리적인 데이터의 집합으로 제2저장장치에 저장된다.

모든 파일은 0과 1의 _비트 패턴(bit pattern)_ 으로 이루어지며, OS 입장에서는 크게 실행 파일과 데이터 파일로 나뉜다.

- 실행 파일 : OS가 메모리로 가져와 CPU를 이용하여 작업을 하는 파일, 즉 사용자의 요청으로 프로세스가 된 파일을 말한다.

- 데이터 파일 : 실행 파일이 작업하는 데 필요한 데이터를 모아놓은 파일이다. 스스로 프로세스가 될 수 없음

<br />

## 파일 이름과 연결 프로그램

- 초창기 OS에는 확장자명이 3자로 제한되었고 그 영향으로 현재도 대부분의 확장자는 3자임
- 파일명에 . 이 여러번 들어갈 수 있는데 마지막 .뒤에 문자를 확장자로 인식함
- 이미지 파일 등의 데이터 파일을 더블클릭하면 해당 파일을 사용하는 응용 프로그램이 실행되는데 이런걸 연결 프로그램이라고 함.

<br />

## 파일 속성

대부분의 파일은 파일 속성을 가지고 있으며 파일 헤더에 기록된다.

OS는 이러한 파일 헤더를 파일 테이블에서 관리한다.

| 속성           | 특징             |
| -------------- | ---------------- |
| name           | 파일의 이름      |
| type           | 파일의 종류      |
| size           | 파일의 크기      |
| time           | 파일의 접근 시간 |
| location       | 파일의 위치      |
| accessiblility | 파일의 접근 권한 |
| owner          | 파일의 소유자    |

- 파일 헤더 : 파일 테이블에서 관리, 일반적인 내용이 담겨있으며 파일이 저장장치에 몇 번째 블록에 있는지도 가지고 있다.
- 고유 헤더 : 데이터 파일에는 응용 프로그램이 필요로 하는 고유 헤더가 따로 있다. 고유 헤더에는 응용 프로그램이 필요로 하는 정보가 담겨 있다.

<br />

## 파일 작업의 유형

파일을 지우거나 이름을 바꾸는 것과 같이 파일을 변경하는 것을 파일 작업 또는 파일 연산(file operation)이라 한다.

### 파일 자체를 변경하는 작업

- open, close

  파일을 더블클릭하면 연결 프로그램이 실행되어 파일이 열린다.

  파일을 다 사용하고 나면 닫는다.

- create

  파일 생성은 새로운 파일을 만드는 것.

- remove, copy, rename

  파일 이동은 저장된 디렉터리의 위치를 변경하는 것.

  파일 복사는 똑같은 파일을 하나 더 만드는 것.

  파일 이름 변경은 파일 이름을 바꾸는 것

- list

  디렉터리에 있는 파일의 이름을 보여주는 것

- search

  여러 디렉터리에서 파일을 찾을 때 사용

### 파일 내용을 변경하는 작업

| 작업     | 설명                    | 작업     | 설명                           |
| -------- | ----------------------- | -------- | ------------------------------ |
| open()   | 파일을 연다.            | write()  | 파일에 새로운 내용을 쓴다.     |
| create() | 새로운 파일을 생성한다. | update() | 파일 내용 중 일부를 변경한다.  |
| close()  | 파일을 닫는다.          | insert() | 파일에 새로운 내용을 추가한다. |
| read()   | 파일 내용을 읽는다.     | delete() | 파일 내용 중 일부를 지운다.    |

<br />

## 파일 구조

파일은 하나의 데이터 덩어리이다. 이 데이터 덩어리를 어떻게 구성하느냐에 따라 순차 파일 구조, 인덱스 파일 구조, 직접 파일 구조로 나뉜다.

<br />

### 순차 파일 구조(sequential file structure)

일반 파일은 기본적으로 순차 파일 구조이다.

- 장점

  - 모든 데이터가 순서대로 기록되기 떄문에 저장 공간에 낭비되는 부분이 없음
  - 구조가 단순
  - 순서대로 데이터를 읽거나 저장할 때 매우 빠름

- 단점

  - 파일에 새로운 데이터를 삽입하거나 삭제할 때 시간이 많이 걸림
  - 중간에 데이터를 삽입하려면 그 뒤에 있는 데이터를 뒤로 밀어 빈 공간을 만들어야하고 삭제할때는 빈 공간을 메우려 땡겨야 한다.
  - 데이터의 변경이 잦은 경우 적합하지 않다.
  - 순차적으로 접근해야 하기 때문에 검색에 적당하지 않음

<br />

### 인덱스 파일 구조(index file structure)

순차 파일 구조에 인덱스 테이블을 추가하여 순차 접근과 직접 접근이 가능하다.

현대의 파일 시스템은 인덱스 파일 구조로, 저장할 떄는 순차 파일 구조로 저장하고 접근할 때는 인덱스 테이블을 보고 원하는 파일에 접근한다.

이러한 특징 때문에 인덱스 파일 구조는 데이터베이스 같은 시스템에 적합하다.

![images_tnwls2_post_775d7260-c2eb-4c6c-b3d4-8de50f6026dc_image](https://user-images.githubusercontent.com/103870198/216799855-2af1639b-0934-4bfe-bcb1-d1538a4c68e2.png)

<br />

### 직접 파일 구조(direct file structure)

저장하려는 데이터의 특정값에 어떤 관계를 정의하여 물리 주소로 바로 변환하는 파일 구조이다.

특정 함수(해시 함수)를 이용해 직접 접근 가능

- 장점

  해시함수를 활용해 주소를 변환하기 때문에 데이터 접근이 빠르다.

- 단점

  전체 데이터가 고르게 저장되는 해시 함수를 찾기 어려움

  해시함수 계산이 복잡할 수도 있다

  저장공간 낭비 문제

<br />
<br />

# 디렉터리의 구조

디렉터리는 관련있는 파일끼리 모아서 하나로 모아놓은 곳이다.

디렉터리는 여러 층으로 구성 가능하며, 이때 최상위 디렉터리를 루트 디렉터리라고 한다.

<br />

## 디렉터리 파일

디렉터리도 파일이다.

일반 파일에는 데이터가 담겨 있고, 디렉터리에는 파일 정보가 담겨 있다.

디렉터리도 헤더를 가지는데 헤더에는 디렉터리의 이름, 만든 시간, 접근 권한 등이 담겨있다.

<br />

## 경로

파일이 전체 디렉터리 중 어디에 있는지를 나타내는 정보

서로 다른 디렉터리에 같은 이름의 파일이 존재할 수 있다.

- 절대 경로 : 루트 디렉터리 기준으로 파일 위치 표시
- 상대 경로 : 현재 위치를 기준으로 파일 위치 표시

<br />

## 디렉터리 구조

- 1단계 구조

  디렉터리 안에 자식 디렉터리 없음

- 다단계 디렉터리 구조

  디렉터리 안에 디렉터리와 파일 저장 가능

<br />

## 마운트

유닉스에서 여러 개의 파티션을 통합하는 명령어

여러 개의 데이터 파일 그룹을 하나인 것처럼 사용 가능 하다.

<br />

## 디스크 파일 할당

파일 시스템은 기본적으로 메인 메모리 시스템과 유사하다.

전체 디스크 공간을 같은 크기로 나누고 각 공간에 주소를 붙여서 관리한다.

이때 같은 크기로 나뉜 공간 하나를 블록이라고 하는데 한 블록의 크기는 1~8KB 정도이다.

- 연속 할당(contiguous allocation)

  연속적으로 배열하는 방식

  저장하거나 삭제하면 빈공간 생기고 맞는 공간 없으면 연속 할당이 불가해서 실제 사용 안함

- 불연속 할당 방식(non-contiguous allocation)

  비어 있는 블록에 데이터를 분산하여 저장한다.

  연결 할당(연결 리스트), 인덱스 할당(인덱스)

<br />

## 연결 할당(linked allocation)

연결 할당은 파일에 속한 데이터를 연결 리스트로 관리하는 방식이다.

파일 테이블에는 시작 블록에 대한 정보만 저장하고, 나머지 데이터는 시작 블록부터 연결하여 저장한다.

파일의 맨 끝에 해댕하는 블록에는 null 삽입

연결 할당 방식은 체인을 연결한것처럼 보여서 체인 할당 이라고도 한다.

구현이 간단하지만 최대 할당 크기에 제한이 있다.

<br />

## 인덱스 할당

연결 리스트 방식의 단점을 해결하기 위해 사용

테이블의 블록 포인터가 데이터 블록을 연결하는게 아니라 데이터의 인덱스를 담고 있는 인덱스 블록을 연결한다.

테이블이 꽉 차서 더 이상 데이터를 연결할 수 없을 때는

인덱스 블록을 연결하는 간접 인덱스 블록을 만들어서 확장 한다.

<br />

## 디스크의 빈 공간 관리

빈 블록의 정보만 모아놓은 빈 공간 리스트를 만들어 유지한다.(내부 단편화 줄임, 빈공간 효율적으로 관리)

<br />
<br />
<br />

<hr >

q1. 파일 시스템에 대해 아는대로 설명해주세요

q2. 인덱스 파일 구조에 대해 설명해주세요

q3. 파일 시스템은 디스크에 파일을 어떤식으로 괸리하나요?
