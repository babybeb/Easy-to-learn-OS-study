# CHAPTER 11 파일 시스템

참고: 

# 파일과 파일 시스템

## 파일 시스템의 개요

- 보안상의 이유로 사용자 대신 파일 관리자가 저장장치 관리를 하는 것이다. 파일 관리자는 파일을 보관하고 관리한다.
- 파일 관리자는 파일 테이블을 사용하여 파일의 생성, 수정, 삭제 등을 수행한다.
- 파일 관리자는 사용자가 파일을 사용하고자 할 때 읽기, 쓰기, 실행과 같은 다양한 접근 방법을 제공한다.
- 사용자가 특정 파일에 접근하기 위해서는 파일 관리자로부터 파일 디스크립터-파일 접근 권한- 을 획득해야 한다.

### 파일 시스템의 기능

| 기능 | 설명 |
| --- | --- |
| 파일 구성 | 사용자의 요구에 따라 파일과 디렉터리를 만든다. |
| 파일 관리 | 파일 생성, 수정, 삭제 등의 관리를 하고, 수시로 조각 모음을 하여 사용자가 파일에 빨리 접근할 수 있도록 한다. |
| 접근 권한 관리 | 다른 사용자로부터 파일을 보호하기 위해 접근 권한을 관리한다. |
| 접근 방법 제공 | 파일을 읽고 쓰고 실행할 수 있도록 사용자에게 접근 방법을 제공한다. |
| 무결성 보장 | 파일의 내용이 손상되지 않도록 무결성을 보장한다. |
| 백업과 복구 | 사고로부터 파일을 보호하기 위해 백업과 복구 작업을 한다. |
| 암호화 | 파일을 암호화하여 악의적인 접근으로부터 파일을 보호한다. |

### 블록과 파일 테이블

- 블록: 저장장치에서 사용하는 가장 작은 단위로, 한 블록에 주소 하나가 할당된다.
- 섹터: 하드디스크의 가장 작은 저장 단위
- 바이트: 메모리의 저장 단위
- 하드디스크의 크기가 메인 메모리의 크기의 수백 배 이상 크기 때문에 섹터마다 주소를 부여하면 너무 많은 양의 주소가 필요하다. 이 때문에 파일 관리자는 여러 섹터를 묶어 하나의 블록으로 만들고, 블록 하나에 주소 하나를 배정한다.
- 포맷을 하면 각 블록에 번호가 매겨지고 파일 테이블에는 파일이 어떤 블록에 있는지 명시된다.

<aside>
💡 **블록 크기에 따른 장단점**
블록 크기를 작게 설정하면 내부 단편화 현상이 줄어들어 저장장치를 효율적으로 쓸 수 있지만, 파일이 여러 블록으로 나뉘어 파일 입출력 속도가 느려진다. 따라서 큰 파일을 많이 사용할 때는 블록 크기를 크게 잡는 것이 좋다.

</aside>

## 파일 분류와 확장자

### 파일

- 논리적인 데이터의 집합으로 하드디스크나 CD 같은 제2 저장장치에 저장된다.
- 모든 파일은 0과 1의 비트 패턴으로 이루어진다.
- 실행 파일과 데이터 파일로 나뉜다.

### 실행 파일

- 운영체제가 메모리로 가져와 CPU를 이용하여 작업을 하는 파일
- 사용자의 요청으로 프로세스가 되는 파일

### 데이터 파일

- 실행 파일이 작업하는 데 필요한 데이터를 모아놓은 파일
- 스스로 프로세스가 될 수 없다.
- 운영체제가 전송하거나 보관만 하고 특별하게 다루지는 않는다.
- Ex:) 사진 파일, 음악 파일, 문서 파일 등

## 파일 속성

### 파일 헤더

- 파일 테이블에서 관리하며 일반적인 내용이 담겨 있다.
- 파일이 저장장치의 몇 번째 블록에 있는지에 대한 정보도 가지고 있다.

| 속성 | 특징 | 속성 | 특징 |
| --- | --- | --- | --- |
| name | 파일의 이름 | location | 파일의 위치 |
| type | 파일의 종류 | accessibility | 파일의 접근 권한 |
| size | 파일의 크기 | owner | 파일의 소유자 |
| time | 파일의 접근 시간 |  |  |

### 고유 헤더

- 데이터 파일에 달려 있는 헤더로, 각 응용 프로그램이 필요로 하는 내용이다.
- 파일의 버전 번호, 크기, 특수 정보 등이 담겨 있다.

<aside>
💡 **파일 복구**
빠른 포맷을 한다면 파일 테이블에 있던 파일 헤더가 사라진다. 하지만 빠른 포맷이나 휴지통에 파일을 버리는 행위는 파일 데이터만 지우고 실제 데이터를 지우지는 않는다. 때문에 파일 테이블에서만 사라질 뿐 실제 데이터는 지워지지 않는다. 따라서 데이터 파일의 고유 헤더는 저장장치에 남아 있다.
파일 복구 프로그램은 모든 블록을 찾아다니면서 고유 헤더에 있는 정보를 이용하여 파일을 원래 상태로 복원한다. 잘 알려지지 않은 헤더는 복구가 안 되지만 JPG, MP3 같은 파일은 헤더에 어떤 정보를 넣을지 전 세계적으로 규격을 정했기 때문에 헤더만 찾는다면 복구할 수 있다.

</aside>

## 파일 작업의 유형

### 파일 자체를 변경하는 작업

사용자 입장에서 수행한다.

| 작업 | 설명 |
| --- | --- |
| open | 파일을 연다. 파일을 더블클릭하면 연결 프로그램이 실행되어 파일이 열린다. 또는 연결 프로그램을 실행한 후 데이터 파일을 가져온다. |
| close | 파일을 다 사용하고 나면 닫는다. 응용 프로그램을 종료해도 자동으로 파일이 닫힌다. |
| create | 새로운 파일을 생성한다. 워드프로세서에서 [새 문서] 메뉴를 클릭하여 작업한 후 파일의 이름을 지정하여 저장하면 파일이 생성된다. 그림판에서 새로운 그림을 그리거나 스캐너로 문서를 스캔하는 경우에도 새로운 파일이 생성된다. |
| remove | 파일을 다른 디렉터리로 이동하거나 휴지통으로 이동하면 파일이 삭제된다. |
| copy | 똑같은 파일을 하나 더 만드는 것이다. |
| rename | 파일 이름을 바꾸는 것이다. |
| list | 디렉터리에 있는 파일의 이름을 보여주는 것이다. 파일의 이름뿐 아니라 크기, 만든 날짜 등도 같이 나열된다. |
| search | 여러 디렉터리에서 파일을 찾을 때 사용한다. 이름순, 크기순, 만든 날짜순 등 다양한 기준으로 검색이 가능하다. 모든 문자를 대체한다는 의미를 가진 ‘*’, 모르는 글자의 수를 지정하는 데 사용되는 ‘?’와 같은 특수 기호를 사용하여 검색할 수도 있다.  |

### 파일 내용을 변경하는 작업

프로세스 입장에서 수행하는 것으로, 주로 함수 형태이다.

| 작업 | 설명 |
| --- | --- |
| open() | 파일을 연다. |
| create() | 새로운 파일을 생성한다. |
| close() | 파일을 닫는다. |
| read() | 파일 내용을 읽는다. |
| write() | 파일에 새로운 내용을 쓴다. |
| update() | 파일 내용 중 일부를 변경한다. |
| insert() | 파일에 새로운 내용을 추가한다. |
| delete() | 파일 내용 중 일부를 지운다. |

## 파일 구조

### 순차 파일 구조

- 파일 내용이 하나의 긴 줄로 늘어선 형태이다.
- 초기의 컴퓨터가 사용한 형태이다.

**장점**

- 모든 데이터가 순서대로 기록되기 때문에 저장 공간에 낭비되는 부분이 없다.
- 구조가 단순하여 테이프는 물론 플로피디스크나 메모리를 이용한 저장장치에도 적용할 수 있다.
- 순서대로 데이터를 읽거나 저장할 때 매우 빠르게 처리된다.

**단점**

- 파일에 새로운 데이터를 삽입하거나 삭제할 때 시간이 많이 걸린다. 중간에 데이터를 삽입하려면 그 뒤에 있는 데이터를 뒤로 밀어 빈 공간을 만들어야 하고, 중간의 데이터를 삭제했을 때는 남은 빈 공간을 메우기 위해 그 뒤에 있는 데이터를 앞으로 당겨야 한다. 따라서 순차 파일 구조는 **데이터의 변경이 잦은 경우에 적당하지 않다.**
- 특정 데이터로 이동할 때 직접 접근이 어렵기 때문에 앞에서부터 순서대로 움직여야 한다. 따라서 순차 파일 구조는 데이터 검색에 적당하지 않다.

### 인덱스 파일 구조

- 순차 파일 구조에서는 특정 데이터에 접근하기 위해 앞에서부터 순차적으로 이동해야 한다. 인덱스 파일 구조는 이러한 단점을 해결한 파일 구조이다.
- 순차 파일 구조에 인덱스 테이블을 추가하여 순차 접근과 직접 접근이 가능하다.
- 현대의 파일 시스템은 인덱스 파일 구조로, 파일을 저장할 때는 순차 파일 구조로 저장하고 파일에 접근할 때는 인덱스 테이블을 보고 원하는 파일에 직접 접근한다.
- 테이블을 여러 개 만들면 다양한 접근이 가능하다.
- 데이터베이스같이 데이터의 빠른 접근이 필요한 시스템에 사용된다.
- 데이터베이스는 일반적으로 B 트리를 이용하여 인덱스를 구성한다.

### 직접 파일 구조

- 저장하려는 데이터의 특정 값에 어떤 관계를 정의하여 물리적인 주소로 바로 변환하는 파일 구조이다.
- 특정 함수를 이용하여 직접 접근이 가능한 파일 구조이다.
- 해시 함수를 사용하여 주소를 변환하기 때문에 데이터 접근이 매우 빠르다.
- 전체 데이터가 고르게 저장될 수 있는 해시 함수를 찾는 것이 매우 중요하다.
- 해시 함수를 잘 찾았다고 하더라도 저장 공간이 낭비되는 문제가 있다.

# 디렉터리의 구조

## 디렉터리의 개념

## 디렉터리 파일

## 경로

## 디렉터리 구조

## 마운트

# 디스크 파일 할당

## 연속 할당과 불연속 할당

## 디스크의 빈 공간 관리